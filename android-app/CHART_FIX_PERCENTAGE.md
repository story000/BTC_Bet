# 折线图基准线修复

## ✅ 已修复问题

折线图现在**以开始游戏时的价格作为基准线（中心线）**，显示相对百分比变化，而不是自动缩放到填满整个高度。

## 🐛 修复前的问题

### 旧逻辑
```javascript
const min = Math.min(...priceHistory);
const max = Math.max(...priceHistory);
const range = max - min;
const y = 100 - ((price - min) / range) * 80 - 10;
```

**问题**：
- ❌ 每次游戏都自动缩放到整个高度
- ❌ 看不出真实的波动幅度
- ❌ 涨 0.1% 和涨 5% 看起来一样
- ❌ 不同游戏之间无法对比

**例子**：
- 游戏 A：起始 $64,000 → 结束 $64,010 (+0.016%)
- 游戏 B：起始 $64,000 → 结束 $64,500 (+0.78%)

两个游戏的折线图看起来**完全一样**（都是从底部到顶部）！

## ✅ 修复后的逻辑

### 新算法
```javascript
// 起始价格固定在 Y = 50（中心线）
const percentChange = ((price - startPrice) / startPrice) * 100;
const yOffset = percentChange * 10; // 1% = 10 像素
const y = 50 - yOffset;
const clampedY = Math.max(10, Math.min(90, y));
```

**优点**：
- ✅ 起始价格始终在中心线（Y = 50）
- ✅ 价格上涨 → 折线在中心线**上方**
- ✅ 价格下跌 → 折线在中心线**下方**
- ✅ 真实反映波动幅度
- ✅ 不同游戏可以直接对比

## 📊 可视化说明

### 图表结构
```
Y = 10  ┬─────────────────────  顶部边界 (+4%)
        │
Y = 45  ┬ ─ ─ ─ ─ ─ ─ ─ ─ ─   参考线 (+0.5%)
        │     ╱╲
Y = 50  ┼════════════════════   起始价格（基准线）
        │         ╲╱
Y = 55  ┴ ─ ─ ─ ─ ─ ─ ─ ─ ─   参考线 (-0.5%)
        │
Y = 90  ┴─────────────────────  底部边界 (-4%)
```

### 缩放比例
- **1% 变化 = 10 像素偏移**
- **可视范围**: -4% 到 +4%
- **超出范围**: 自动截断到边界

### 参考线
1. **白色虚线 (Y=50)**: 起始价格基准线
2. **绿色虚线 (Y=45)**: +0.5% 参考
3. **红色虚线 (Y=55)**: -0.5% 参考

## 🎮 实际效果

### 场景 1：价格上涨 1%
```
起始: $64,000
结束: $64,640 (+1%)

折线图:
     ╱──────  ← 在中心线上方 10 像素
═══════════════ ← 起始价格线
```

### 场景 2：价格下跌 0.5%
```
起始: $64,000
结束: $63,680 (-0.5%)

折线图:
═══════════════ ← 起始价格线
     ╲──────  ← 在中心线下方 5 像素
```

### 场景 3：大幅波动
```
起始: $64,000
最高: $64,960 (+1.5%)
最低: $63,360 (-1%)
结束: $64,320 (+0.5%)

折线图:
      ╱╲        ← 波峰 (+1.5%)
     ╱  ╲
═══════════════ ← 起始价格线
        ╲╱      ← 波谷 (-1%)
         ╲───   ← 结束 (+0.5%)
```

## 🔢 具体案例

### Bitcoin 10秒游戏

**典型波动范围**: 0.01% - 0.5%

| 价格变化 | 百分比 | Y 偏移 | 视觉效果 |
|---------|-------|--------|---------|
| $64,000 → $64,032 | +0.05% | ↑ 0.5px | 几乎不可见 |
| $64,000 → $64,160 | +0.25% | ↑ 2.5px | 轻微上扬 |
| $64,000 → $64,320 | +0.5% | ↑ 5px | 明显上扬 |
| $64,000 → $64,640 | +1% | ↑ 10px | 显著上扬 |
| $64,000 → $63,680 | -0.5% | ↓ 5px | 明显下跌 |
| $64,000 → $62,720 | -2% | ↓ 20px | 大幅下跌 |

### 边界情况

如果价格变化超过 ±4%：
- 折线会被截断到可视范围内
- 但游戏逻辑仍使用真实价格计算胜负
- 极少发生（Bitcoin 10秒内变化 >4% 非常罕见）

## 🎯 用户体验提升

### 修复前
```
游戏 1: +0.1% → 折线图从底到顶（看起来涨很多）
游戏 2: +2.0% → 折线图从底到顶（看起来涨很多）
```
❌ 用户无法判断实际涨幅

### 修复后
```
游戏 1: +0.1% → 折线在中心线附近微微波动
游戏 2: +2.0% → 折线明显上扬到上方区域
```
✅ 用户一眼就能看出实际波动幅度

## 🧪 测试验证

### 安装新版本
```bash
cd android-app
./gradlew installDebug
```

### 测试步骤
1. 打开游戏，点击 RISE
2. START GAME
3. 观察折线图：
   - ✅ 应该从中心线（白色虚线）开始
   - ✅ 价格上涨时，折线向上偏移
   - ✅ 价格下跌时，折线向下偏移
   - ✅ 波动幅度与实际价格变化成比例

### 对比测试
玩 3-5 局游戏，观察：
- ✅ 大涨局：折线明显在中心线上方
- ✅ 小涨局：折线在中心线略微上方
- ✅ 下跌局：折线在中心线下方
- ✅ 不同游戏的图表可以对比

## 📱 技术细节

### SVG 坐标系统
- **宽度**: 300 单位（X = 0 到 300）
- **高度**: 100 单位（Y = 0 到 100）
- **Y轴**: 向下递增（SVG 标准）

### Y 坐标计算
```javascript
percentChange = ((price - startPrice) / startPrice) * 100
// 例: (64320 - 64000) / 64000 * 100 = 0.5%

yOffset = percentChange * 10
// 例: 0.5 * 10 = 5

y = 50 - yOffset
// 例: 50 - 5 = 45 (上涨，Y减小)

clampedY = Math.max(10, Math.min(90, y))
// 限制在 [10, 90] 范围
```

### 参数调整

如果觉得折线变化太小或太大，可以调整缩放系数：

```javascript
// 当前: 1% = 10 像素
const yOffset = percentChange * 10;

// 更敏感: 1% = 20 像素
const yOffset = percentChange * 20;

// 更平缓: 1% = 5 像素
const yOffset = percentChange * 5;
```

## 🎉 总结

**现在折线图真实反映价格波动了！**
- ✅ 起始价格固定在中心线
- ✅ 涨跌幅度真实可见
- ✅ 不同游戏可以对比
- ✅ 符合用户预期

每次游戏都有**独特的价格曲线**，而不是千篇一律的"从底到顶"！
